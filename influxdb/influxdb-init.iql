CREATE RETENTION POLICY "forever" ON telegraf DURATION INF REPLICATION 1 SHARD DURATION 7d;
CREATE RETENTION POLICY "yearly" ON telegraf DURATION 52w REPLICATION 1 SHARD DURATION 7d;
CREATE RETENTION POLICY "monthly" ON telegraf DURATION 30d REPLICATION 1 SHARD DURATION 1d;
CREATE RETENTION POLICY "weekly" ON telegraf DURATION 7d REPLICATION 1 SHARD DURATION 1d;
CREATE RETENTION POLICY "daily" ON telegraf DURATION 24h REPLICATION 1 SHARD DURATION 1h;
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_weekly" ON telegraf BEGIN SELECT MAX("active_power_regulation_setpoint") AS "active_power_regulation_setpoint", MAX("arm_software_version") AS "arm_software_version", MAX("battery_charge_power_from_pv") AS "battery_charge_power_from_pv", MAX("battery_charge_power_from_pv_monthly") AS "battery_charge_power_from_pv_monthly", MAX("battery_charge_power_from_pv_today") AS "battery_charge_power_from_pv_today", MAX("battery_charge_power_from_pv_yearly") AS "battery_charge_power_from_pv_yearly", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_state_of_healthy") AS "battery_state_of_healthy", MAX("battery_temperature") AS "battery_temperature", MAX("battery_voltage") AS "battery_voltage", MAX("co2_reduction") AS "co2_reduction", MAX("daily_battery_charge_from_pv") AS "daily_battery_charge_from_pv", MAX("daily_battery_discharge_energy") AS "daily_battery_discharge_energy", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_direct_energy_consumption") AS "daily_direct_energy_consumption", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_power_yields") AS "daily_power_yields", MAX("daily_pv_energy_yields") AS "daily_pv_energy_yields", MAX("daily_pv_export") AS "daily_pv_export", MAX("daily_pv_generation") AS "daily_pv_generation", MAX("daily_running_time") AS "daily_running_time", MAX("direct_power_consumption_monthly_pv") AS "direct_power_consumption_monthly_pv", MAX("direct_power_consumption_pv") AS "direct_power_consumption_pv", MAX("direct_power_consumption_today_pv") AS "direct_power_consumption_today_pv", MAX("direct_power_consumption_yearly_pv") AS "direct_power_consumption_yearly_pv", MAX("drm_state") AS "drm_state", MAX("dsp_software_version") AS "dsp_software_version", MAX("export_power_from_pv") AS "export_power_from_pv", MAX("export_power_from_pv_monthly") AS "export_power_from_pv_monthly", MAX("export_power_from_pv_today") AS "export_power_from_pv_today", MAX("export_power_from_pv_yearly") AS "export_power_from_pv_yearly", MAX("export_power_hybrid") AS "export_power_hybrid", MAX("export_to_grid") AS "export_to_grid", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_state") AS "grid_state", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temperature") AS "internal_temperature", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("load_power_hybrid") AS "load_power_hybrid", MAX("meter_power") AS "meter_power", MAX("monthly_pv_energy_yields") AS "monthly_pv_energy_yields", MAX("mppt_1_current") AS "mppt_1_current", MAX("mppt_1_voltage") AS "mppt_1_voltage", MAX("mppt_2_current") AS "mppt_2_current", MAX("mppt_2_voltage") AS "mppt_2_voltage", MAX("nominal_active_power") AS "nominal_active_power", MAX("phase_a_current") AS "phase_a_current", MAX("phase_a_voltage") AS "phase_a_voltage", MAX("phase_b_current") AS "phase_b_current", MAX("phase_b_voltage") AS "phase_b_voltage", MAX("phase_c_current") AS "phase_c_current", MAX("phase_c_voltage") AS "phase_c_voltage", MAX("power_factor") AS "power_factor", MAX("power_factor_setting") AS "power_factor_setting", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("power_limitation_adjustment") AS "power_limitation_adjustment", MAX("power_limitation_setting") AS "power_limitation_setting", MAX("protocol_number") AS "protocol_number", MAX("protocol_version") AS "protocol_version", MAX("pv_power_of_today") AS "pv_power_of_today", MAX("reactive_power_adjustment") AS "reactive_power_adjustment", MAX("reactive_power_percentage_setting") AS "reactive_power_percentage_setting", MAX("running_state") AS "running_state", MAX("self_consumption_of_day") AS "self_consumption_of_day", MAX("total_active_power") AS "total_active_power", MAX("total_battery_charge_from_pv") AS "total_battery_charge_from_pv", MAX("total_battery_discharge_energy") AS "total_battery_discharge_energy", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_direct_energy_consumption") AS "total_direct_energy_consumption", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_power_yields") AS "total_power_yields", MAX("total_pv_export") AS "total_pv_export", MAX("total_pv_generation") AS "total_pv_generation", MAX("total_reactive_power") AS "total_reactive_power", MAX("yearly_pv_energy_yields") AS "yearly_pv_energy_yields" INTO "weekly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(1m) END
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_monthly" ON telegraf BEGIN SELECT MAX("active_power_regulation_setpoint") AS "active_power_regulation_setpoint", MAX("arm_software_version") AS "arm_software_version", MAX("battery_charge_power_from_pv") AS "battery_charge_power_from_pv", MAX("battery_charge_power_from_pv_monthly") AS "battery_charge_power_from_pv_monthly", MAX("battery_charge_power_from_pv_today") AS "battery_charge_power_from_pv_today", MAX("battery_charge_power_from_pv_yearly") AS "battery_charge_power_from_pv_yearly", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_state_of_healthy") AS "battery_state_of_healthy", MAX("battery_temperature") AS "battery_temperature", MAX("battery_voltage") AS "battery_voltage", MAX("co2_reduction") AS "co2_reduction", MAX("daily_battery_charge_from_pv") AS "daily_battery_charge_from_pv", MAX("daily_battery_discharge_energy") AS "daily_battery_discharge_energy", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_direct_energy_consumption") AS "daily_direct_energy_consumption", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_power_yields") AS "daily_power_yields", MAX("daily_pv_energy_yields") AS "daily_pv_energy_yields", MAX("daily_pv_export") AS "daily_pv_export", MAX("daily_pv_generation") AS "daily_pv_generation", MAX("daily_running_time") AS "daily_running_time", MAX("direct_power_consumption_monthly_pv") AS "direct_power_consumption_monthly_pv", MAX("direct_power_consumption_pv") AS "direct_power_consumption_pv", MAX("direct_power_consumption_today_pv") AS "direct_power_consumption_today_pv", MAX("direct_power_consumption_yearly_pv") AS "direct_power_consumption_yearly_pv", MAX("drm_state") AS "drm_state", MAX("dsp_software_version") AS "dsp_software_version", MAX("export_power_from_pv") AS "export_power_from_pv", MAX("export_power_from_pv_monthly") AS "export_power_from_pv_monthly", MAX("export_power_from_pv_today") AS "export_power_from_pv_today", MAX("export_power_from_pv_yearly") AS "export_power_from_pv_yearly", MAX("export_power_hybrid") AS "export_power_hybrid", MAX("export_to_grid") AS "export_to_grid", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_state") AS "grid_state", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temperature") AS "internal_temperature", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("load_power_hybrid") AS "load_power_hybrid", MAX("meter_power") AS "meter_power", MAX("monthly_pv_energy_yields") AS "monthly_pv_energy_yields", MAX("mppt_1_current") AS "mppt_1_current", MAX("mppt_1_voltage") AS "mppt_1_voltage", MAX("mppt_2_current") AS "mppt_2_current", MAX("mppt_2_voltage") AS "mppt_2_voltage", MAX("nominal_active_power") AS "nominal_active_power", MAX("phase_a_current") AS "phase_a_current", MAX("phase_a_voltage") AS "phase_a_voltage", MAX("phase_b_current") AS "phase_b_current", MAX("phase_b_voltage") AS "phase_b_voltage", MAX("phase_c_current") AS "phase_c_current", MAX("phase_c_voltage") AS "phase_c_voltage", MAX("power_factor") AS "power_factor", MAX("power_factor_setting") AS "power_factor_setting", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("power_limitation_adjustment") AS "power_limitation_adjustment", MAX("power_limitation_setting") AS "power_limitation_setting", MAX("protocol_number") AS "protocol_number", MAX("protocol_version") AS "protocol_version", MAX("pv_power_of_today") AS "pv_power_of_today", MAX("reactive_power_adjustment") AS "reactive_power_adjustment", MAX("reactive_power_percentage_setting") AS "reactive_power_percentage_setting", MAX("running_state") AS "running_state", MAX("self_consumption_of_day") AS "self_consumption_of_day", MAX("total_active_power") AS "total_active_power", MAX("total_battery_charge_from_pv") AS "total_battery_charge_from_pv", MAX("total_battery_discharge_energy") AS "total_battery_discharge_energy", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_direct_energy_consumption") AS "total_direct_energy_consumption", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_power_yields") AS "total_power_yields", MAX("total_pv_export") AS "total_pv_export", MAX("total_pv_generation") AS "total_pv_generation", MAX("total_reactive_power") AS "total_reactive_power", MAX("yearly_pv_energy_yields") AS "yearly_pv_energy_yields" INTO "monthly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(10m) END
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_yearly" ON telegraf BEGIN SELECT MAX("active_power_regulation_setpoint") AS "active_power_regulation_setpoint", MAX("arm_software_version") AS "arm_software_version", MAX("battery_charge_power_from_pv") AS "battery_charge_power_from_pv", MAX("battery_charge_power_from_pv_monthly") AS "battery_charge_power_from_pv_monthly", MAX("battery_charge_power_from_pv_today") AS "battery_charge_power_from_pv_today", MAX("battery_charge_power_from_pv_yearly") AS "battery_charge_power_from_pv_yearly", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_state_of_healthy") AS "battery_state_of_healthy", MAX("battery_temperature") AS "battery_temperature", MAX("battery_voltage") AS "battery_voltage", MAX("co2_reduction") AS "co2_reduction", MAX("daily_battery_charge_from_pv") AS "daily_battery_charge_from_pv", MAX("daily_battery_discharge_energy") AS "daily_battery_discharge_energy", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_direct_energy_consumption") AS "daily_direct_energy_consumption", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_power_yields") AS "daily_power_yields", MAX("daily_pv_energy_yields") AS "daily_pv_energy_yields", MAX("daily_pv_export") AS "daily_pv_export", MAX("daily_pv_generation") AS "daily_pv_generation", MAX("daily_running_time") AS "daily_running_time", MAX("direct_power_consumption_monthly_pv") AS "direct_power_consumption_monthly_pv", MAX("direct_power_consumption_pv") AS "direct_power_consumption_pv", MAX("direct_power_consumption_today_pv") AS "direct_power_consumption_today_pv", MAX("direct_power_consumption_yearly_pv") AS "direct_power_consumption_yearly_pv", MAX("drm_state") AS "drm_state", MAX("dsp_software_version") AS "dsp_software_version", MAX("export_power_from_pv") AS "export_power_from_pv", MAX("export_power_from_pv_monthly") AS "export_power_from_pv_monthly", MAX("export_power_from_pv_today") AS "export_power_from_pv_today", MAX("export_power_from_pv_yearly") AS "export_power_from_pv_yearly", MAX("export_power_hybrid") AS "export_power_hybrid", MAX("export_to_grid") AS "export_to_grid", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_state") AS "grid_state", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temperature") AS "internal_temperature", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("load_power_hybrid") AS "load_power_hybrid", MAX("meter_power") AS "meter_power", MAX("monthly_pv_energy_yields") AS "monthly_pv_energy_yields", MAX("mppt_1_current") AS "mppt_1_current", MAX("mppt_1_voltage") AS "mppt_1_voltage", MAX("mppt_2_current") AS "mppt_2_current", MAX("mppt_2_voltage") AS "mppt_2_voltage", MAX("nominal_active_power") AS "nominal_active_power", MAX("phase_a_current") AS "phase_a_current", MAX("phase_a_voltage") AS "phase_a_voltage", MAX("phase_b_current") AS "phase_b_current", MAX("phase_b_voltage") AS "phase_b_voltage", MAX("phase_c_current") AS "phase_c_current", MAX("phase_c_voltage") AS "phase_c_voltage", MAX("power_factor") AS "power_factor", MAX("power_factor_setting") AS "power_factor_setting", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("power_limitation_adjustment") AS "power_limitation_adjustment", MAX("power_limitation_setting") AS "power_limitation_setting", MAX("protocol_number") AS "protocol_number", MAX("protocol_version") AS "protocol_version", MAX("pv_power_of_today") AS "pv_power_of_today", MAX("reactive_power_adjustment") AS "reactive_power_adjustment", MAX("reactive_power_percentage_setting") AS "reactive_power_percentage_setting", MAX("running_state") AS "running_state", MAX("self_consumption_of_day") AS "self_consumption_of_day", MAX("total_active_power") AS "total_active_power", MAX("total_battery_charge_from_pv") AS "total_battery_charge_from_pv", MAX("total_battery_discharge_energy") AS "total_battery_discharge_energy", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_direct_energy_consumption") AS "total_direct_energy_consumption", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_power_yields") AS "total_power_yields", MAX("total_pv_export") AS "total_pv_export", MAX("total_pv_generation") AS "total_pv_generation", MAX("total_reactive_power") AS "total_reactive_power", MAX("yearly_pv_energy_yields") AS "yearly_pv_energy_yields" INTO "yearly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(30m) END
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_forever" ON telegraf BEGIN SELECT MAX("active_power_regulation_setpoint") AS "active_power_regulation_setpoint", MAX("arm_software_version") AS "arm_software_version", MAX("battery_charge_power_from_pv") AS "battery_charge_power_from_pv", MAX("battery_charge_power_from_pv_monthly") AS "battery_charge_power_from_pv_monthly", MAX("battery_charge_power_from_pv_today") AS "battery_charge_power_from_pv_today", MAX("battery_charge_power_from_pv_yearly") AS "battery_charge_power_from_pv_yearly", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_state_of_healthy") AS "battery_state_of_healthy", MAX("battery_temperature") AS "battery_temperature", MAX("battery_voltage") AS "battery_voltage", MAX("co2_reduction") AS "co2_reduction", MAX("daily_battery_charge_from_pv") AS "daily_battery_charge_from_pv", MAX("daily_battery_discharge_energy") AS "daily_battery_discharge_energy", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_direct_energy_consumption") AS "daily_direct_energy_consumption", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_power_yields") AS "daily_power_yields", MAX("daily_pv_energy_yields") AS "daily_pv_energy_yields", MAX("daily_pv_export") AS "daily_pv_export", MAX("daily_pv_generation") AS "daily_pv_generation", MAX("daily_running_time") AS "daily_running_time", MAX("direct_power_consumption_monthly_pv") AS "direct_power_consumption_monthly_pv", MAX("direct_power_consumption_pv") AS "direct_power_consumption_pv", MAX("direct_power_consumption_today_pv") AS "direct_power_consumption_today_pv", MAX("direct_power_consumption_yearly_pv") AS "direct_power_consumption_yearly_pv", MAX("drm_state") AS "drm_state", MAX("dsp_software_version") AS "dsp_software_version", MAX("export_power_from_pv") AS "export_power_from_pv", MAX("export_power_from_pv_monthly") AS "export_power_from_pv_monthly", MAX("export_power_from_pv_today") AS "export_power_from_pv_today", MAX("export_power_from_pv_yearly") AS "export_power_from_pv_yearly", MAX("export_power_hybrid") AS "export_power_hybrid", MAX("export_to_grid") AS "export_to_grid", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_state") AS "grid_state", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temperature") AS "internal_temperature", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("load_power_hybrid") AS "load_power_hybrid", MAX("meter_power") AS "meter_power", MAX("monthly_pv_energy_yields") AS "monthly_pv_energy_yields", MAX("mppt_1_current") AS "mppt_1_current", MAX("mppt_1_voltage") AS "mppt_1_voltage", MAX("mppt_2_current") AS "mppt_2_current", MAX("mppt_2_voltage") AS "mppt_2_voltage", MAX("nominal_active_power") AS "nominal_active_power", MAX("phase_a_current") AS "phase_a_current", MAX("phase_a_voltage") AS "phase_a_voltage", MAX("phase_b_current") AS "phase_b_current", MAX("phase_b_voltage") AS "phase_b_voltage", MAX("phase_c_current") AS "phase_c_current", MAX("phase_c_voltage") AS "phase_c_voltage", MAX("power_factor") AS "power_factor", MAX("power_factor_setting") AS "power_factor_setting", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("power_limitation_adjustment") AS "power_limitation_adjustment", MAX("power_limitation_setting") AS "power_limitation_setting", MAX("protocol_number") AS "protocol_number", MAX("protocol_version") AS "protocol_version", MAX("pv_power_of_today") AS "pv_power_of_today", MAX("reactive_power_adjustment") AS "reactive_power_adjustment", MAX("reactive_power_percentage_setting") AS "reactive_power_percentage_setting", MAX("running_state") AS "running_state", MAX("self_consumption_of_day") AS "self_consumption_of_day", MAX("total_active_power") AS "total_active_power", MAX("total_battery_charge_from_pv") AS "total_battery_charge_from_pv", MAX("total_battery_discharge_energy") AS "total_battery_discharge_energy", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_direct_energy_consumption") AS "total_direct_energy_consumption", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_power_yields") AS "total_power_yields", MAX("total_pv_export") AS "total_pv_export", MAX("total_pv_generation") AS "total_pv_generation", MAX("total_reactive_power") AS "total_reactive_power", MAX("yearly_pv_energy_yields") AS "yearly_pv_energy_yields" INTO "forever"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(1h) END
ALTER RETENTION POLICY "daily" ON "telegraf" DEFAULT;
use telegraf;
INSERT INTO forever rp_config rp="daily" 86401000000000
INSERT INTO forever rp_config rp="weekly" 604801000000000
INSERT INTO forever rp_config rp="monthly" 2592001000000000
INSERT INTO forever rp_config rp="yearly" 31536001000000000
INSERT INTO forever rp_config rp="forever" 9223372036854775806